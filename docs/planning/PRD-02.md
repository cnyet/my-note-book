# 智能化工作台 - 产品需求文档 (PRD)

**版本**: v1.0
**创建日期**: 2026-02-06
**状态**: 已确认
**文档来源**: 基于 7 轮需求访谈（@docs/planning/QA-02.md）

---

## 1. 产品概述

### 1.1 产品定位
**个人智能化工作台** - 仅供一人使用，用于记录生活、工作、学习，并展示个人开发作品。

### 1.2 核心目标
- 将学习知识、工作经验转化为可视化成果
- 测试 AI 开发能力
- 构建完整的个人知识管理系统

### 1.3 目标用户
- 单用户（开发者本人）
- 技术背景，熟悉 AI 工具

---

## 2. 功能需求

### 2.1 核心智能体（5个）

#### 2.1.1 News Agent（资讯智能体）
**功能描述**: 每日自动爬取最新 AI 资讯

**输入**:
- 无（定时自动执行）

**输出**:
- 10 条最新 AI 资讯
- 字段：标题、摘要、链接、发布时间、来源

**数据来源**:
- 主数据源: `https://www.aibase.com/zh/news/`
- 备用数据源: 如爬取失败，提示"今日AI资讯更新失败，请稍后再试"

**执行规则**:
- 每天 8:00 自动执行（后台定时任务）
- 如果定时任务失败，用户首次打开 Agents 页面时自动触发
- 若某天无新资讯，显示历史数据

---

#### 2.1.2 Outfit Agent（穿搭智能体）
**功能描述**: 根据天气和日程推荐每日穿搭，生成图文建议

**输入**:
- 天气数据（公共天气 API）
- 日程安排（来自 Task Agent）
- 用户健康指标（来自 Life Agent，影响舒适度推荐）

**输出**:
- 文字穿搭建议
- 极简插画风格图片（本地 Ollama 模型生成）

**执行规则**:
- 每天 8:00 自动执行（与 News Agent 同步）
- 用户每天首次进入 Agents 页面时自动生成图片
- 生成失败时显示固定静态占位图
- 用户需等待图片加载

---

#### 2.1.3 Task Agent（任务智能体）
**功能描述**: 根据问答表单生成今日待办事项

**输入**:
- 固定表单问答（系统预设问题）
- 表单字段：工作计划、优先级、截止时间等

**输出**:
- 待办事项列表（最多 10 条/天）
- 数据结构：标题、描述、优先级、截止时间

**交互规则**:
- 用户可在 Agents 页面直接标记任务完成（打勾）
- 标记完成后任务变灰
- 编辑/删除操作需进入管理后台
- 若用户未填写表单，系统生成默认任务

---

#### 2.1.4 Life Agent（生活智能体）
**功能描述**: 记录健康指标，生成饮食运动建议

**输入**:
- 用户手动填写健康指标
- 字段：身高(150-200cm)、体重(40-120kg)、健康状况、运动频率、饮食偏好

**输出**:
- 今日饮食建议（图文卡片）
- 今日运动建议（图文卡片）
- 建议生成逻辑：结合历史趋势

**校验规则**:
- 身高/体重超出范围时提示错误

---

#### 2.1.5 Review Agent（复盘智能体）
**功能描述**: 今日复盘，反思与洞察，自动提取用户偏好

**输入**:
- Task Agent 待办事项完成情况
- Life Agent 健康指标数据
- 用户行为历史

**输出**:
- 今日工作总结（表格展示）
- 反思与洞察
- 自动提取用户偏好：工作习惯、学习偏好等

**数据存储**:
- 用户偏好长期保存（个人中心）
- 用户偏好可手动编辑
- 用户偏好影响 Review Agent 的输出逻辑

---

### 2.2 LobeChat 集成

**功能描述**: 本地部署的 AI 对话系统，可调用 5 个智能体能力

**核心能力**:
- 实时调用智能体生成结果（不落库）
- 可选将结果写入对应智能体当日记录
- 对话历史保存 15 天

**集成方式**:
- 独立页面嵌入，与 5 个智能体并列展示
- 通过 API 接口与后端系统集成
- 本地部署，对接 Ollama（无需修改源码，不定制 UI）

**数据管理**:
- 支持清空某天/全部对话历史
- 对话历史与智能体数据不直接关联

---

### 2.3 管理后台

#### 2.3.1 认证系统
- **注册/登录**: 标准注册登录流程
- **记住我**: 24 小时 session 有效期
- **二次验证**: 每次进入管理后台都需输入密码验证
- **密码安全**: bcrypt 加密存储
- **暴力破解防护**: 登录失败次数限制

#### 2.3.2 仪表板 (Dashboard)
- 智能体工作流程可视化
- 数据流监控
- API 调用情况统计
- 智能体运行日志（实时更新）
- 性能指标
- 错误告警（本地弹窗）

#### 2.3.3 智能体配置 (Agents CRUD)
**可配置字段**:
- 名称、描述、图标
- 权重、优先级
- 触发条件
- 输入参数、输出参数
- 启用/禁用开关

**操作权限**: 完整的增删改查功能

#### 2.3.4 博客管理 (Blog)
- **文章来源**: 经验总结、工作总结、学习笔记
- **编辑器功能**: 图片上传、代码高亮、Markdown 预览
- **发布规则**: 无草稿状态，无定时发布

#### 2.3.5 工具管理 (Tools)
- **工具类型**: 自开发小工具（计算器、单位转换等）
- **管理方式**: 表格 + CRUD 操作
- **操作权限**: 仅管理后台可操作

#### 2.3.6 实验室管理 (Labs)
- **展示内容**: 其他开发项目（如贪吃蛇）
- **集成方式**: 嵌入 iframe
- **管理方式**: 表格 + CRUD 操作

#### 2.3.7 数据导出
- **导出格式**: PDF、Excel、JSON、CSV
- **时间范围**: 最近 15 天（按天导出）
- **内容范围**: 所有智能体历史记录（可选择）
- **图片处理**: 只导出图片链接/文件路径/元数据（本地路径格式: `/uploads/outfit/2025-02-06.png`）
- **触发位置**: 管理后台

---

### 2.4 前端页面

#### 2.4.1 Home 页面
- 粒子背景动效
- 骨架屏加载动画
- 首次访问显示示例数据

#### 2.4.2 Agents 页面
- **布局**: 网格布局，同时展示 LobeChat + 5 个智能体卡片
- **交互顺序**: 非强制（建议流程：News+Outfit → Task → Life → Review）
- **手动触发**: Agents 页面可手动触发今日 News/Outfit 任务

#### 2.4.3 初始化向导
- 首次使用时填写基本信息
- 设置偏好
- 5 个智能体首次运行需要用户提供初始数据

#### 2.4.4 响应式设计
- **移动端**: 参考 `frontend/design-assets/pages/` 设计稿
- **管理后台**: 仅桌面端
- **平板端**: 桌面端布局

---

## 3. 数据规则

### 3.1 数据保留策略
- **智能体内容**: 保存 15 天后自动删除（定时任务实现）
- **用户偏好**: 长期保存
- **LobeChat 对话**: 保存 15 天
- **管理后台数据**: 博客/工具/实验室数据长期保存

### 3.2 数据流转规则
- 5 个智能体之间数据共享：
  - Review Agent 读取 Task Agent 待办完成情况
  - Review Agent 读取 Life Agent 健康指标
  - Life Agent 健康指标影响 Outfit Agent 穿搭建议
- Task Agent 和 Life Agent 数据自动流入 Review Agent

### 3.3 数据导出规则
- **时间范围**: 只能导出最近 15 天
- **导出单位**: 按天导出
- **图片处理**: 只包含图片路径，不包含图片文件本体

---

## 4. 技术规格

### 4.1 技术栈选型

| 层级 | 技术选型 | 说明 |
|------|---------|------|
| 前端框架 | Next.js 15.5 | React 服务端渲染框架 |
| UI 组件库 | shadcn/ui | 高度可定制的组件库 |
| 内部组件 | v-ui | Genesis Design System 定制化组件 |
| 状态管理 | Zustand | 轻量级全局状态管理 |
| 后端框架 | FastAPI (Python 3.11+) | 现代异步框架，AI生态友好 |
| ORM | SQLAlchemy 2.0 | Python标准ORM |
| 数据库 | SQLite | 个人使用，并发需求低 |
| AI 模型 | Ollama (Qwen + DeepSeek) | 本地部署，无需外部 API 费用 |
| 任务队列 | SQLite + APScheduler | 后台任务队列实现 |
| 定时任务 | APScheduler | 持久化定时任务（重启恢复 + 当天补跑） |

### 4.2 部署架构

**部署方式**: 本地服务器
**容器化**: Docker Compose（分离前端/后端/数据库服务）
**编排**: Docker Compose
**域名**: 无需
**HTTPS**: 无需

### 4.3 CI/CD

- **平台**: GitHub Actions
- **流程**: 代码推送 → 自动测试 → 自动部署到生产环境
- **测试覆盖率**: 80%
- **测试类型**: 单元测试 + 集成测试 + E2E 测试
- **AI 质量测试**: 需要

### 4.4 开发环境

- **环境分离**: 开发环境与生产环境分离
- **Mock 策略**: 开发时需要 Mock AI API（避免频繁调用 Ollama）
- **Seed 数据**: 需要用于开发测试
- **预置数据**: 通过数据库迁移脚本插入（5 个智能体、3 篇博客、3 个工具、3 个实验室）

---

## 5. 失败场景与降级策略

### 5.1 News Agent 失败
- **爬取被封禁**: 切换备用数据源（`https://www.aibase.com/zh/news/`）
- **定时任务失败**: 用户打开页面时提示"今日AI资讯更新失败，请稍后再试"
- **网络问题**: 重试 3 次后失败

### 5.2 Outfit Agent 失败
- **天气 API 失败**: 提示失败
- **图片生成失败**: 显示固定静态占位图
- **本地模型不可用**: 显示占位图

### 5.3 Task/Life Agent 失败
- **用户未填写**: 生成默认数据
- **数据校验失败**: 提示错误并要求重新输入

### 5.4 Review Agent 失败
- **无 Task/Life 数据**: 基于历史数据推测

### 5.5 通用失败处理
- **AI 生成失败**: 友好提示 + "重新生成"按钮 + 点赞/点踩反馈机制
- **任务队列失败**: 自动重试 3 次，失败后管理后台提供"手动重试"按钮

---

## 6. 安全要求

### 6.1 认证安全
- 密码 bcrypt 加密
- Session 24 小时有效期
- 登录失败次数限制（防暴力破解）

### 6.2 数据安全
- API 密钥通过 .env 管理（.gitignore 忽略）
- 用户密码加密存储
- 敏感数据不暴露在前端

### 6.3 备份策略
- **频率**: 每周备份
- **存储**: 本地
- **用途**: 防误删、导出留存、迁移、习惯性保留
- **恢复**: 服务器崩溃或数据丢失时不用恢复

### 6.4 迁移脚本
- **用途**: SQLite → PostgreSQL 迁移
- **场景**: 误删/想留存/换机器/迁移
- **特性**: 可重复运行、增量迁移
- **目的**: 纯学习练手

---

## 7. MVP 范围优先级

### 7.1 必须实现（MVP 核心）
- ✅ 前端页面（Home + Agents + 管理后台）
- ✅ 后端 API
- ✅ 数据库（SQLite）
- ✅ 定时任务（node-schedule + 持久化）
- ✅ 数据自动删除（15 天）
- ✅ 后台任务队列（SQLite 底层）
- ✅ 5 个智能体完整功能
- ✅ LobeChat 集成
- ✅ 认证系统（注册/登录/二次验证）
- ✅ 数据导出功能

### 7.2 可后续迭代
- 🔄 Labs 展示产品
- 🔄 Blogs 文章
- 🔄 Tools 工具

### 7.3 可砍掉（时间有限时）
- ❌ Tools 工具

### 7.4 智能体优先级
- **全部实现**: 5 个智能体都要在 MVP 中实现
- **如只能 3 个**: News + Outfit + Life（优先级最高）

### 7.5 管理后台优先级
- **全部实现**: 所有功能都需要在 MVP 中实现
- **仪表板**: 可先实现基础 CRUD，高级可视化后续再加

---

## 8. 用户体验细节

### 8.1 首次使用体验
- 首次访问显示示例数据
- 初始化向导（基本信息 + 偏好设置）
- 5 个智能体首次运行需要用户初始数据

### 8.2 错误提示
- AI 生成失败：友好提示
- 提供"重新生成"按钮
- 用户反馈机制：点赞/点踩

### 8.3 加载体验
- **首屏**: 骨架屏 + 加载动画
- **Agents 页面**: 早上 8:00 结果已缓存，立即显示
- **图片**: 不压缩、不 CDN、不懒加载

---

## 9. 附录

### 9.1 需求来源
- 完整需求访谈记录: `@docs/planning/QA-02.md`（7 轮问答）

### 9.2 设计参考
- **风格参考**: `https://clawdbotai.co`（配色、动效、布局）
- **移动端设计**: `frontend/design-assets/pages/`
- **架构文档**: `docs/design/architecture.md`
- **数据库设计**: `docs/design/database-schema.md`
- **前端规范**: `docs/design/frontend.md`

### 9.3 相关文档
- 项目路线图: `@docs/planning/roadmap-02.md`
- OpenSpec 规范: `@/openspec/AGENTS.md`

---

**文档审批**:
- 产品经理: ✅ 已确认
- 架构师: ✅ 已确认
- 开发团队: 待确认
