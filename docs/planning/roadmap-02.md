# 智能化工作台 - 项目路线图

**版本**: v1.0
**创建日期**: 2026-02-06
**状态**: 已确认
**文档来源**: 基于产品需求文档（@docs/planning/PRD-02.md）

---

## 项目概述

**产品名称**: 智能化工作台（Personal AI Workspace）
**目标**: 构建个人使用的完整智能化工作平台，集成 5 个智能体 + LobeChat + 管理后台
**部署方式**: 本地服务器，Docker Compose 容器化
**技术栈**: Next.js 15.5 + FastAPI (Python) + SQLAlchemy + SQLite + Ollama (Qwen+DeepSeek)
**MVP 周期**: 分 4 个阶段完成

---

## 阶段规划

### 阶段 1: 基础架构搭建（预计 1-2 周）

**目标**: 完成项目基础架构、开发环境、数据库设计

#### 1.1 项目初始化
- [ ] 初始化 Next.js 前端项目
- [ ] 初始化 Node.js/Express 后端项目
- [ ] 配置开发/生产环境分离
- [ ] 配置 Docker Compose（前端/后端/数据库容器）
- [ ] 配置 GitHub Actions CI/CD 流水线

#### 1.2 数据库设计与实现
- [ ] 设计数据库 Schema（参考 `docs/design/database-schema.md`）
- [ ] 创建数据表：
  - `users`（用户表）
  - `agents`（智能体配置表）
  - `agent_news`（资讯记录）
  - `agent_outfit`（穿搭记录）
  - `agent_task`（任务记录）
  - `agent_life`（健康记录）
  - `agent_review`（复盘记录）
  - `user_preferences`（用户偏好）
  - `lobechat_history`（对话历史）
  - `blogs`（博客）
  - `tools`（工具）
  - `labs`（实验室项目）
  - `tasks_queue`（任务队列表）
  - `scheduled_jobs`（定时任务记录）
- [ ] 实现数据库迁移脚本
- [ ] 实现 SQLite → PostgreSQL 迁移脚本（可重复/增量）

#### 1.3 基础工具配置
- [ ] 配置 Zustand 状态管理（全局状态：登录态/主题/当日工作流/任务列表）
- [ ] 配置 shadcn/ui 组件库
- [ ] 配置代码规范（ESLint + Prettier）
- [ ] 配置测试框架（Jest + React Testing Library + Cypress）
- [ ] 配置 Mock 服务（AI API Mock）

#### 1.4 预置数据
- [ ] 创建数据库迁移脚本插入预置数据
  - 5 个智能体基础配置
  - 3 篇博客示例
  - 3 个工具示例
  - 3 个实验室项目示例
- [ ] 创建开发环境 Seed 数据

**交付物**:
- ✅ 可运行的本地开发环境
- ✅ 完整的数据库 Schema 和迁移脚本
- ✅ CI/CD 流水线配置
- ✅ 预置数据可正常加载

---

### 阶段 2: 核心功能实现（预计 2-3 周）

**目标**: 完成 5 个智能体核心功能、认证系统、基础 API

#### 2.1 认证系统
- [ ] 实现用户注册/登录 API
- [ ] 实现 bcrypt 密码加密
- [ ] 实现 Session 管理（24 小时有效期）
- [ ] 实现"记住我"功能
- [ ] 实现登录失败次数限制（防暴力破解）
- [ ] 实现管理后台二次验证（每次进入需验证）

#### 2.2 定时任务系统
- [ ] 集成 APScheduler (Python)
- [ ] 实现定时任务持久化机制（重启恢复）
- [ ] 实现补跑逻辑（错过 8:00 则当天补跑）
- [ ] 创建定时任务表（`scheduled_jobs`）
- [ ] 实现定时任务执行历史记录
- [ ] 实现手动触发接口（Agents 页面可触发）

#### 2.3 后台任务队列
- [ ] 实现基于 SQLite 的任务队列 (SQLAlchemy + APScheduler)
- [ ] 实现任务类型：
  - 资讯爬取 (News Agent)
  - 穿搭图片生成 (Outfit Agent)
  - Review 生成 (Review Agent)
  - 数据清理（15 天自动删除）
- [ ] 实现任务重试机制（失败重试 3 次）
- [ ] 实现任务状态管理（待处理/处理中/成功/失败）
- [ ] 管理后台提供"手动重试"按钮

#### 2.4 News Agent
- [ ] 实现网站爬取功能（主数据源 + 备用数据源）
- [ ] 实现资讯数据解析和存储
- [ ] 实现定时任务（每天 8:00 执行）
- [ ] 实现失败降级策略（提示失败信息）
- [ ] 实现 API 接口（获取今日资讯）

#### 2.5 Outfit Agent
- [ ] 集成天气 API
- [ ] 实现穿搭建议生成逻辑（文字）
- [ ] 集成 Ollama 本地模型（生成极简插画）
- [ ] 实现图片生成触发（每天首次进入自动生成）
- [ ] 实现失败降级（固定静态占位图）
- [ ] 实现 API 接口（获取今日穿搭）

#### 2.6 Task Agent
- [ ] 设计固定表单问答
- [ ] 实现待办事项生成逻辑
- [ ] 实现数据结构：标题、描述、优先级、截止时间
- [ ] 实现限制：最多 10 条/天
- [ ] 实现默认数据生成（用户未填写时）
- [ ] 实现 API 接口（创建/获取/标记完成任务）

#### 2.7 Life Agent
- [ ] 设计健康指标表单
- [ ] 实现数据校验（身高 150-200cm，体重 40-120kg）
- [ ] 实现饮食/运动建议生成逻辑（结合历史趋势）
- [ ] 实现图文卡片展示
- [ ] 实现 API 接口（记录/获取健康数据）

#### 2.8 Review Agent
- [ ] 实现数据聚合（Task + Life）
- [ ] 实现复盘内容生成逻辑
- [ ] 实现用户偏好提取和更新
- [ ] 实现用户偏好手动编辑
- [ ] 实现表格展示
- [ ] 实现 API 接口（生成/获取今日复盘）

#### 2.9 数据清理
- [ ] 实现 15 天自动删除定时任务
- [ ] 清理范围：智能体内容、LobeChat 对话
- [ ] 保留：用户偏好、博客、工具、实验室数据

**交付物**:
- ✅ 5 个智能体完整功能
- ✅ 认证系统完整功能
- ✅ 定时任务系统（持久化 + 补跑）
- ✅ 任务队列系统（重试 + 手动重试）
- ✅ 所有核心 API 接口

---

### 阶段 3: 前端页面与 LobeChat 集成（预计 2 周）

**目标**: 完成所有前端页面、LobeChat 集成、用户交互

#### 3.1 Home 页面
- [ ] 实现粒子背景动效
- [ ] 实现骨架屏加载动画
- [ ] 首次访问显示示例数据
- [ ] 实现响应式设计（移动端）

#### 3.2 Agents 页面
- [ ] 实现网格布局（LobeChat + 5 个智能体卡片）
- [ ] 实现 News Agent 展示（10 条资讯列表）
- [ ] 实现 Outfit Agent 展示（文字 + 图片）
- [ ] 实现 Task Agent 展示（待办列表 + 完成打勾）
- [ ] 实现 Life Agent 展示（表单 + 建议卡片）
- [ ] 实现 Review Agent 展示（表格 + 复盘内容）
- [ ] 实现手动触发按钮（News/Outfit）
- [ ] 实现"重新生成"按钮（各智能体）
- [ ] 实现点赞/点踩反馈机制
- [ ] 实现友好错误提示

#### 3.3 初始化向导
- [ ] 实现首次使用引导页
- [ ] 实现基本信息填写
- [ ] 实现偏好设置
- [ ] 实现智能体初始数据收集

#### 3.4 LobeChat 集成
- [ ] 本地部署 LobeChat
- [ ] 开发 API 接口与后端系统集成
- [ ] 实现智能体调用能力（实时生成 + 可选落库）
- [ ] 配置 Ollama 对接（无需修改源码）
- [ ] 实现对话历史管理（15 天保留）
- [ ] 实现清空历史功能（某天/全部）
- [ ] 嵌入独立页面（与智能体并列）

#### 3.5 管理后台 - 认证相关
- [ ] 实现登录/注册页面
- [ ] 实现二次验证弹窗
- [ ] 实现 Session 管理（24 小时）

#### 3.6 管理后台 - 仪表板
- [ ] 实现智能体工作流程可视化
- [ ] 实现数据流监控
- [ ] 实现 API 调用统计
- [ ] 实现实时运行日志展示
- [ ] 实现性能指标展示
- [ ] 实现错误告警（本地弹窗）

#### 3.7 管理后台 - 智能体配置
- [ ] 实现智能体列表页（表格）
- [ ] 实现智能体详情页
- [ ] 实现增删改查功能
- [ ] 可配置字段：名称、描述、图标、权重、优先级、触发条件、输入/输出参数
- [ ] 实现启用/禁用开关

#### 3.8 管理后台 - 博客管理
- [ ] 实现博客列表页（表格）
- [ ] 实现博客编辑器（图片上传、代码高亮、Markdown 预览）
- [ ] 实现增删改查功能
- [ ] 实现发布功能（无草稿、无定时）

#### 3.9 管理后台 - 工具管理
- [ ] 实现工具列表页（表格）
- [ ] 实现工具配置页
- [ ] 实现增删改查功能

#### 3.10 管理后台 - 实验室管理
- [ ] 实现实验室列表页（表格）
- [ ] 实现 iframe 嵌入配置
- [ ] 实现增删改查功能

#### 3.11 管理后台 - 数据导出
- [ ] 实现导出配置页
- [ ] 实现按天导出功能（最近 15 天）
- [ ] 实现多格式导出：PDF、Excel、JSON、CSV
- [ ] 实现图片路径导出（本地路径）
- [ ] 实现选择性导出（可选择智能体）

#### 3.12 管理后台 - 任务队列管理
- [ ] 实现任务队列列表页
- [ ] 实现任务状态展示
- [ ] 实现手动重试按钮

#### 3.13 响应式设计
- [ ] 移动端适配（参考设计稿）
- [ ] 平板端适配（桌面布局）
- [ ] 管理后台仅桌面端

**交付物**:
- ✅ 所有前端页面完整功能
- ✅ LobeChat 集成完成
- ✅ 管理后台所有功能
- ✅ 响应式设计完成

---

### 阶段 4: 测试、优化与部署（预计 1-2 周）

**目标**: 完成全面测试、性能优化、文档编写、部署上线

#### 4.1 单元测试
- [ ] 实现后端 API 单元测试（覆盖率 ≥80%）
- [ ] 实现前端组件单元测试
- [ ] 实现工具函数单元测试
- [ ] 实现数据库操作单元测试

#### 4.2 集成测试
- [ ] 实现智能体工作流集成测试
- [ ] 实现数据流转集成测试
- [ ] 实现定时任务集成测试
- [ ] 实现任务队列集成测试
- [ ] 实现认证系统集成测试

#### 4.3 E2E 测试
- [ ] 实现用户注册/登录 E2E 测试
- [ ] 实现智能体使用流程 E2E 测试
- [ ] 实现管理后台操作 E2E 测试
- [ ] 实现数据导出 E2E 测试

#### 4.4 AI 质量测试
- [ ] 测试 News Agent 爬取准确性
- [ ] 测试 Outfit Agent 建议合理性
- [ ] 测试 Task Agent 生成质量
- [ ] 测试 Life Agent 建议准确性
- [ ] 测试 Review Agent 复盘质量
- [ ] 测试 LobeChat 对话质量

#### 4.5 性能优化
- [ ] 优化首屏加载速度（骨架屏）
- [ ] 优化图片加载策略
- [ ] 优化 API 响应时间
- [ ] 优化数据库查询性能
- [ ] 优化任务队列处理效率

#### 4.6 失败场景测试
- [ ] 测试 News 爬取失败降级
- [ ] 测试 Outfit 图片生成失败降级
- [ ] 测试天气 API 失败处理
- [ ] 测试 AI 生成失败提示
- [ ] 测试任务重试机制
- [ ] 测试定时任务补跑逻辑

#### 4.7 安全测试
- [ ] 测试密码加密安全性
- [ ] 测试 Session 安全性
- [ ] 测试登录失败限制
- [ ] 测试二次验证有效性
- [ ] 测试 API 密钥保护

#### 4.8 备份与迁移测试
- [ ] 测试每周备份功能
- [ ] 测试 SQLite → PostgreSQL 迁移脚本
- [ ] 测试增量迁移功能
- [ ] 测试可重复运行

#### 4.9 文档编写
- [ ] 编写用户使用手册
- [ ] 编写开发者文档
- [ ] 编写 API 文档
- [ ] 编写部署文档
- [ ] 编写维护手册

#### 4.10 部署上线
- [ ] 构建生产环境镜像
- [ ] 配置 Docker Compose 生产环境
- [ ] 部署到本地服务器
- [ ] 运行预置数据迁移
- [ ] 验证所有功能正常
- [ ] 配置 GitHub Actions 自动部署

#### 4.11 验收测试
- [ ] 执行完整用户流程测试
- [ ] 验证所有需求点已实现
- [ ] 验证性能符合预期
- [ ] 验证错误处理正确
- [ ] 验证备份功能正常

**交付物**:
- ✅ 完整测试报告（覆盖率 80%+）
- ✅ 优化后的生产环境
- ✅ 完整项目文档
- ✅ 部署上线的可运行系统
- ✅ 验收测试通过

---

## 后续迭代计划

### 迭代 1: 功能增强（可选）
- [ ] 添加更多智能体（如 Finance Agent、Learning Agent）
- [ ] 增强数据可视化（健康趋势图表、任务完成率图表）
- [ ] 添加智能提醒功能
- [ ] 实现智能体之间的更复杂数据流转

### 迭代 2: 性能优化（可选）
- [ ] 实现 Redis 缓存层
- [ ] 优化数据库索引
- [ ] 实现图片压缩和 CDN
- [ ] 实现懒加载优化

### 迭代 3: 扩展功能（可选）
- [ ] 实现多用户支持
- [ ] 实现移动端 App
- [ ] 实现数据同步功能
- [ ] 实现开放 API

---

## 里程碑计划

| 里程碑 | 预计完成时间 | 关键交付物 |
|--------|-------------|-----------|
| **M1**: 基础架构完成 | 第 2 周 | 开发环境、数据库、CI/CD |
| **M2**: 核心功能完成 | 第 5 周 | 5 个智能体 + 认证 + 定时任务 + 任务队列 |
| **M3**: 前端与集成完成 | 第 7 周 | 所有页面 + LobeChat 集成 + 管理后台 |
| **M4**: 测试与上线 | 第 9 周 | 完整测试 + 部署上线 + 文档 |

**总预计周期**: 8-10 周（可根据实际进度调整）

---

## 风险与应对

### 技术风险
1. **Ollama 模型生成速度慢**
   - 应对：优化提示词，设置合理超时时间

2. **SQLite 并发性能不足**
   - 应对：监控性能，必要时迁移 PostgreSQL

3. **定时任务持久化复杂**
   - 应对：简化逻辑，优先保证核心功能

### 时间风险
1. **开发时间超预期**
   - 应对：优先保证 MVP 核心功能，非核心功能后续迭代

2. **测试发现问题较多**
   - 应对：预留充足测试时间，分阶段测试

### 需求风险
1. **需求变更**
   - 应对：严格遵循已确认的需求文档（PRD-02.md），重大变更需重新评估

---

## 附录

### 相关文档
- 产品需求文档: `@docs/planning/PRD-02.md`
- 需求访谈记录: `@docs/planning/QA-02.md`
- 架构设计文档: `docs/design/architecture.md`
- 数据库设计: `docs/design/database-schema.md`
- 前端规范: `docs/design/frontend.md`

### 技术参考
- Next.js 官方文档
- Express.js 官方文档
- Ollama 官方文档
- LobeChat 官方文档
- Docker Compose 官方文档

---

**文档审批**:
- 项目经理: ✅ 已确认
- 架构师: ✅ 已确认
- 开发团队: 待确认
