# Conversation Accuracy Skill - 使用指南

## 快速开始

### 1. 激活技能
```
应用 conversation-accuracy 治理规范
```

### 2. 自动触发场景
- 对话超过 10 轮
- 做出重要架构决策
- 完成复杂任务
- 用户明确要求记录

---

## 工作流程

```
┌──────────────┐     ┌──────────────┐     ┌──────────────┐
│   开始对话    │────▶│   维护上下文  │────▶│   检测决策   │
└──────────────┘     └──────────────┘     └──────────────┘
                                                 │
                                                 ▼
                                          ┌──────────────┐
                                          │  生成决策文档  │
                                          └──────────────┘
                                                 │
                    ┌────────────────────────────┼────────────────────────────┐
                    ▼                            ▼                            ▼
             ┌──────────────┐            ┌──────────────┐            ┌──────────────┐
             │ session-     │            │ decisions-   │            │ context-     │
             │ summary.md   │            │ log.md       │            │ index.md     │
             └──────────────┘            └──────────────┘            └──────────────┘
```

---

## 命令参考

### 自动命令
| 命令 | 功能 | 触发条件 |
|------|------|----------|
| `维护上下文` | 四层记忆管理 | 每轮对话 |
| `生成决策文档` | 记录重要决策 | 决策确认时 |
| `更新会话摘要` | 压缩近期对话 | 超过10轮 |

### 手动命令
| 命令 | 功能 |
|------|------|
| `生成决策文档` | 从当前上下文生成决策文档 |
| `更新会话摘要` | 手动更新会话摘要 |
| `加载历史记忆` | 从 .claude/memory/ 加载历史 |
| `查看决策记录` | 显示项目所有决策 |

---

## 文档结构

### `.claude/memory/decisions.md`
```markdown
# 项目决策记录

> 自动生成于 [时间]
> 技能: conversation-accuracy-skill v2.0.0

---

## [2025-01-15 10:30 UTC] 采用 Next.js 14 + shadcn/ui

**背景**: 需要快速构建管理后台，要求现代化 UI
**方案对比**:
- Next.js 14: App Router + Server Components → ✅ 性能优秀
- Vue 3 + Nuxt: → ❌ 团队不熟悉
- React + Vite: → ⚠️ 缺少 SSR

**决策**: 采用 Next.js 14 + shadcn/ui
**理由**: 团队熟悉、性能优秀、组件丰富

**影响文件**:
- frontend/package.json
- frontend/app/

**下一步**:
- [x] 初始化项目
- [ ] 配置 Tailwind
- [ ] 设置 shadcn/ui

**标签**: #architecture #frontend
```

### `.claude/memory/session-summary.md`
```markdown
# 会话摘要

## Session 2025-01-15

### 用户请求
1. 初始化项目结构
2. 配置开发环境
3. 创建基础组件

### 关键决策
1. 采用 Monorepo 结构 → decisions.md#2025-01-15-001
2. 使用 pnpm workspace → decisions.md#2025-01-15-002

### 待办事项
- [ ] 完成用户认证模块
- [ ] 编写 API 文档

### 摘要
本次会话完成了项目初始化，采用 Next.js 14 + FastAPI 技术栈，配置了基础的 Monorepo 结构和开发环境。
```

---

## 最佳实践

### 1. 时间处理
```markdown
✅ 推荐: 2025-01-15 10:30 UTC
❌ 避免: 2025-01-15 10:30 (缺少时区)
```

### 2. 决策记录时机
- 架构变更时立即记录
- API 设计确定后记录
- 重要技术选型时记录
- 性能优化方案确定时记录

### 3. 标签使用
```markdown
#architecture  - 架构决策
#api          - API 设计
#database     - 数据库相关
#security     - 安全实现
#performance  - 性能优化
#ui-ux        - UI/UX 选择
#bugfix       - Bug 修复
#feature      - 新功能
```

---

## 跨会话记忆

### 新会话启动时
```
请先加载 .claude/memory/decisions.md 了解项目历史
```

### AI 自动加载
AI 在处理任务前会自动检查：
1. `.claude/memory/decisions.md` - 决策历史
2. `.claude/memory/session-summary.md` - 近期上下文
3. `.claude/memory/context-index.md` - 快速索引

---

## 故障排除

### 问题：决策文档未生成
**解决方案**:
1. 检查 `.claude/memory/` 目录是否存在
2. 确认已激活技能
3. 手动执行 `生成决策文档`

### 问题：历史记忆未加载
**解决方案**:
1. 确认文件存在且格式正确
2. 检查文件编码（UTF-8）
3. 使用 `加载历史记忆` 命令

---

## 版本历史
- **v2.0.0** (2025-01-15): 新增自动持久化功能
- **v1.0.0**: 初始版本（仅上下文管理）
