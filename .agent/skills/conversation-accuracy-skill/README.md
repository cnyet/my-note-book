# Conversation Accuracy Skill v2.0

> **项目级 AI 对话治理技能** - 自动持久化决策文档，跨会话保持 90%+ 准确率

---

## 核心功能

| 功能 | 说明 |
|------|------|
| 四层记忆架构 | 短期/中期/长期/系统编排 |
| 自动决策文档 | 重要决策自动保存到 `.claude/memory/` |
| 跨会话记忆 | 新会话可加载历史决策 |
| 动态上下文修剪 | Token 智能分配，防止信息稀释 |

---

## 文件结构

```
.claude/
├── skills/
│   └── conversation-accuracy-skill/
│       ├── SKILL.md          # 技能定义
│       ├── USAGE.md          # 使用指南
│       └── README.md         # 本文件
└── memory/
    ├── decisions.md          # 决策记录 (持久化)
    ├── session-summary.md    # 会话摘要
    ├── context-index.md      # 快速索引
    ├── template.md           # 决策模板
    └── .gitkeep              # 目录说明
```

---

## 快速开始

### 激活技能
```
应用 conversation-accuracy 治理规范
```

### 自动触发
- 对话超过 10 轮
- 做出重要决策
- 完成复杂任务

### 手动命令
| 命令 | 功能 |
|------|------|
| `生成决策文档` | 从当前上下文生成决策记录 |
| `更新会话摘要` | 更新会话摘要文件 |
| `加载历史记忆` | 加载历史决策到上下文 |
| `查看决策记录` | 显示所有项目决策 |

---

## 决策文档格式

```markdown
## [2025-02-09 14:30 UTC] Decision: 采用 Next.js 14 + shadcn/ui

**背景**: 需要快速构建管理后台
**方案对比**:
- Next.js 14: 性能优秀、团队熟悉 → ✅
- Vue 3 + Nuxt: 团队不熟悉 → ❌

**决策**: 采用 Next.js 14 + shadcn/ui
**理由**: 团队熟悉、性能优秀、组件丰富

**影响范围**:
- frontend/package.json
- frontend/app/

**下一步**:
- [x] 初始化项目
- [ ] 配置 Tailwind

**标签**: #architecture #frontend
```

---

## 四层记忆架构

```
┌─────────────────────────────────────────────────────────────┐
│                     System Orchestration                     │
│                    (Token 智能分配)                          │
└─────────────────────────────────────────────────────────────┘
        │                    │                    │
        ▼                    ▼                    ▼
┌──────────────┐    ┌──────────────┐    ┌──────────────┐
│   短期上下文   │    │   中期摘要    │    │   长期记忆    │
│ (3-5轮原始)   │    │ (24h压缩)     │    │ (持久化存储)  │
└──────────────┘    └──────────────┘    └──────────────┘
                                              │
                                              ▼
                                    .claude/memory/decisions.md
```

---

## 版本历史

| 版本 | 日期 | 变更 |
|------|------|------|
| 2.0.0 | 2025-02-09 | 新增自动持久化 + 项目级文档 |
| 1.0.0 | - | 初始版本（仅上下文管理） |

---

## 技术规格

- **Token 分配** (8K 限制):
  - 短期上下文: 50% (4000)
  - 长期记忆: 19% (1500)
  - 中期摘要: 12% (1000)
  - 系统指令: 6% (500)
  - 输入+缓冲: 12% (1000)

- **重要性评分**:
  - 关键词 ("决定"/"重要"): 10x
  - 行动项: 5x
  - 时间衰减: 2x
  - 默认: 1x

---

## 标签系统

| 标签 | 用途 |
|------|------|
| #architecture | 架构决策 |
| #api | API 设计 |
| #database | 数据库相关 |
| #security | 安全实现 |
| #performance | 性能优化 |
| #ui-ux | UI/UX 选择 |
| #devops | CI/CD、部署 |
| #bugfix | Bug 修复 |
| #refactor | 代码重构 |
| #feature | 新功能 |

---

## 最佳实践

1. **时间处理**: 统一使用 UTC 时区
2. **摘要策略**: 任务型用提取式，创意型用抽象式
3. **自动持久化**: 重要决策立即记录
4. **跨会话引用**: 新会话先加载 `decisions.md`
5. **标签规范**: 每个决策至少 2 个标签

---

## 故障排除

### 问题：技能未自动触发
**解决**: 明确说 "应用 conversation-accuracy 治理规范"

### 问题：决策文档未生成
**解决**: 检查 `.claude/memory/` 目录权限

### 问题：历史记忆未加载
**解决**: 使用 `加载历史记忆` 命令显式加载

---

## 集成

与其他技能配合：
- `prompt-optimization`: 优化提问质量
- `react-best-practices`: React 相关决策
- `openspec`: 与提案流程集成

---

## 许可证

MIT License

---

## 作者

my-note-book-kimi 项目
